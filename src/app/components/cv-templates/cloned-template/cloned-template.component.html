<!-- MAIN CV FORM -->
<div
  class="cvContainer"
  *ngIf="!displayMode"
  [style.font-family]="editOptions.font"
  [style.font-size]="editOptions.fontSize"
  [style.line-height]="editOptions.lineHeight"
>
  <form #CV [formGroup]="cvForm">
    <div class="cvTitle">
      <p
        style="width: 100%; text-align: center"
        class="form-input"
        formControlName="cvTitle"
        contenteditable
      ></p>
    </div>
    <div class="cvHeader">
      <div class="cvHeader__avatar">
        <img
          [src]="profileImage"
          style="cursor: pointer"
          (click)="imageEditorIsOn = true"
        />
      </div>
      <div class="cvHeader__profile">
        <div class="cvHeader__profile__name" formGroupName="basics">
          <p
            style="width: 100%; text-align: center"
            class="form-input"
            formControlName="name"
            contenteditable
          ></p>
        </div>
        <div class="cvHeader__profile__title">
          <p class="form-input" formControlName="title" contenteditable></p>
        </div>
      </div>
    </div>
    <div class="cvMain">
      <div class="cvMain__left" #leftSide>
        <div class="cvBlock" formGroupName="basics">
          <div id="contactInfo">
            <div class="profileInfo d-flex align-items-center">
              <i class="fa fa-user" [style.color]="editOptions.themeColor"></i>
              <p
                class="form-input"
                formControlName="gender"
                contenteditable
              ></p>
            </div>
            <div class="profileInfo d-flex align-items-center">
              <i
                class="fa fa-calendar-alt"
                [style.color]="editOptions.themeColor"
              ></i>
              <p class="form-input" formControlName="dob" contenteditable></p>
            </div>
            <div class="profileInfo d-flex align-items-center">
              <i
                class="fa fa-envelope-square"
                [style.color]="editOptions.themeColor"
              ></i>
              <p class="form-input" formControlName="email" contenteditable></p>
            </div>
            <div class="profileInfo d-flex align-items-center">
              <i class="fa fa-phone" [style.color]="editOptions.themeColor"></i>
              <p class="form-input" formControlName="phone" contenteditable></p>
            </div>
            <div class="profileInfo d-flex align-items-center">
              <i class="fa fa-link" [style.color]="editOptions.themeColor"></i>
              <p class="form-input" formControlName="link" contenteditable></p>
            </div>
            <div class="profileInfo d-flex align-items-center">
              <i class="fa fa-home" [style.color]="editOptions.themeColor"></i>
              <p
                class="form-input"
                formControlName="address"
                contenteditable
              ></p>
            </div>
          </div>
        </div>
        <div class="cvBlock" *ngIf="display.objective">
          <ng-container
            *ngTemplateOutlet="controller2; context: { field: 'objective' }"
          ></ng-container>
          <div
            class="cvBlock__title"
            [style.background-color]="editOptions.themeColor"
          >
            Mục tiêu nghề nghiệp
          </div>
          <div class="cvBlock__objective pr-16">
            <p
              class="form-input"
              formControlName="objective"
              contenteditable
            ></p>
          </div>
        </div>
        <div class="cvBlock" *ngIf="display.skills">
          <ng-container
            *ngTemplateOutlet="controller2; context: { field: 'skills' }"
          ></ng-container>
          <div
            class="cvBlock__title"
            [style.background-color]="editOptions.themeColor"
          >
            Các kỹ năng
          </div>
          <div formArrayName="skills">
            <div
              class="cvInfoDetail pr-16"
              *ngFor="let control of skills.controls; let i = index"
              [formGroupName]="i"
            >
              <ng-container
                *ngTemplateOutlet="
                  controller;
                  context: { index: i, form: skills }
                "
              ></ng-container>
              <div>
                <p
                  class="form-input input-bold"
                  formControlName="name"
                  contenteditable
                ></p>
                <p
                  class="form-input"
                  formControlName="level"
                  contenteditable
                ></p>
              </div>
            </div>
          </div>
        </div>
        <div class="cvBlock" *ngIf="display.interests">
          <ng-container
            *ngTemplateOutlet="controller2; context: { field: 'interests' }"
          ></ng-container>
          <div
            class="cvBlock__title"
            [style.background-color]="editOptions.themeColor"
          >
            Sở thích
          </div>
          <p class="form-input" formControlName="interests" contenteditable></p>
        </div>
        <div class="cvBlock" *ngIf="display.references">
          <ng-container
            *ngTemplateOutlet="controller2; context: { field: 'references' }"
          ></ng-container>
          <div
            class="cvBlock__title"
            [style.background-color]="editOptions.themeColor"
          >
            Người tham chiếu
          </div>
          <div formArrayName="references">
            <div
              class="cvInfoDetail pr-16"
              *ngFor="let control of references.controls; let i = index"
              [formGroupName]="i"
            >
              <ng-container
                *ngTemplateOutlet="
                  controller;
                  context: { index: i, form: references }
                "
              ></ng-container>
              <div>
                <p
                  class="form-input input-bold"
                  formControlName="name"
                  contenteditable
                ></p>
                <p
                  class="form-input"
                  formControlName="reference"
                  contenteditable
                ></p>
              </div>
            </div>
          </div>
        </div>
        <div class="cvBlock" *ngIf="display.additionalInformation">
          <ng-container
            *ngTemplateOutlet="
              controller2;
              context: { field: 'additionalInformation' }
            "
          ></ng-container>
          <div
            class="cvBlock__title"
            [style.background-color]="editOptions.themeColor"
          >
            Thông tin thêm
          </div>
          <p
            class="form-input"
            formControlName="additionalInformation"
            contenteditable
          ></p>
        </div>
      </div>
      <div class="cvMain__right">
        <div
          class="cvBlock"
          formArrayName="education"
          *ngIf="display.education"
        >
          <ng-container
            *ngTemplateOutlet="controller2; context: { field: 'education' }"
          ></ng-container>
          <div
            class="cvBlock__title"
            [style.background-color]="editOptions.themeColor"
          >
            Học vấn
          </div>
          <div
            class="cvBlock__educationTable cvInfoDetail pr-16"
            *ngFor="let control of education.controls; let i = index"
            [formGroupName]="i"
          >
            <ng-container
              *ngTemplateOutlet="
                controller;
                context: { index: i, form: education }
              "
            ></ng-container>
            <div
              class="cvBlock__educationTable__title d-flex align-items-center"
            >
              <i
                class="fa fa-graduation-cap"
                [style.color]="editOptions.themeColor"
              ></i>
              <p
                class="form-input input-bold"
                contenteditable
                formControlName="institution"
              ></p>
              <span>, </span>
              <p class="form-input" contenteditable formControlName="major"></p>
            </div>
            <div
              class="
                cvBlock__educationTable__educationTime
                d-flex
                align-items-center
              "
            >
              <p
                class="form-input"
                contenteditable
                formControlName="startDate"
              ></p>
              <span>-</span>
              <p
                class="form-input"
                contenteditable
                formControlName="endDate"
              ></p>
            </div>
            <div class="cvBlock__educationTable__description">
              <p
                class="form-input"
                contenteditable
                formControlName="summary"
              ></p>
            </div>
          </div>
        </div>
        <div
          class="cvBlock"
          formArrayName="workExperience"
          *ngIf="display.work"
        >
          <ng-container
            *ngTemplateOutlet="controller2; context: { field: 'work' }"
          ></ng-container>
          <div
            class="cvBlock__title"
            [style.background-color]="editOptions.themeColor"
          >
            Kinh nghiệm làm việc
          </div>
          <div
            class="cvInfoDetail pr-16"
            *ngFor="let control of work.controls; let i = index"
            [formGroupName]="i"
          >
            <ng-container
              *ngTemplateOutlet="controller; context: { index: i, form: work }"
            ></ng-container>
            <div class="d-flex align-items-center">
              <i
                class="fa fa-briefcase"
                [style.color]="editOptions.themeColor"
              ></i>
              <p
                class="form-input input-bold"
                contenteditable
                formControlName="name"
              ></p>
              <span>, </span>
              <p
                class="form-input"
                contenteditable
                formControlName="position"
              ></p>
            </div>
            <div class="d-flex align-items-center">
              <p
                class="form-input"
                contenteditable
                formControlName="startDate"
              ></p>
              <span> - </span>
              <p
                class="form-input"
                contenteditable
                formControlName="endDate"
              ></p>
            </div>
            <div>
              <p
                class="form-input"
                style="width: 100%"
                formControlName="summary"
                contenteditable
              ></p>
            </div>
          </div>
        </div>
        <div
          class="cvBlock"
          formArrayName="activities"
          *ngIf="display.activities"
        >
          <ng-container
            *ngTemplateOutlet="controller2; context: { field: 'activities' }"
          ></ng-container>
          <div
            class="cvBlock__title"
            [style.background-color]="editOptions.themeColor"
          >
            Hoạt động
          </div>
          <div
            class="cvBlock__educationTable cvInfoDetail pr-16"
            *ngFor="let control of activities.controls; let i = index"
            [formGroupName]="i"
          >
            <ng-container
              *ngTemplateOutlet="
                controller;
                context: { index: i, form: activities }
              "
            ></ng-container>
            <div class="d-flex align-items-center">
              <i class="fa fa-child" [style.color]="editOptions.themeColor"></i>
              <p
                class="form-input input-bold"
                contenteditable
                formControlName="organization"
              ></p>
              <span>, </span>
              <p
                class="form-input"
                contenteditable
                formControlName="position"
              ></p>
            </div>
            <div class="d-flex align-items-center">
              <p
                class="form-input"
                contenteditable
                formControlName="startDate"
              ></p>
              <span>-</span>
              <p
                class="form-input"
                contenteditable
                formControlName="endDate"
              ></p>
            </div>
            <div>
              <p
                class="form-input"
                contenteditable
                formControlName="summary"
              ></p>
            </div>
          </div>
        </div>
        <div class="cvBlock" formArrayName="awards" *ngIf="display.awards">
          <ng-container
            *ngTemplateOutlet="controller2; context: { field: 'awards' }"
          ></ng-container>
          <div
            class="cvBlock__title"
            [style.background-color]="editOptions.themeColor"
          >
            Giải thưởng
          </div>
          <div
            class="cvInfoDetail pr-16"
            *ngFor="let control of awards.controls; let i = index"
            [formGroupName]="i"
          >
            <ng-container
              *ngTemplateOutlet="
                controller;
                context: { index: i, form: awards }
              "
            ></ng-container>
            <div class="d-flex align-items-center">
              <p
                class="form-input input-bold"
                formControlName="date"
                contenteditable
              ></p>
              <p
                class="form-input"
                formControlName="summary"
                contenteditable
              ></p>
            </div>
          </div>
        </div>
        <div
          class="cvBlock"
          formArrayName="certifications"
          *ngIf="display.certifications"
        >
          <ng-container
            *ngTemplateOutlet="
              controller2;
              context: { field: 'certifications' }
            "
          ></ng-container>
          <div
            class="cvBlock__title"
            [style.background-color]="editOptions.themeColor"
          >
            Chứng chỉ
          </div>
          <div
            class="cvInfoDetail pr-16"
            *ngFor="let control of certifications.controls; let i = index"
            [formGroupName]="i"
          >
            <ng-container
              *ngTemplateOutlet="
                controller;
                context: { index: i, form: certifications }
              "
            ></ng-container>
            <div class="d-flex align-items-center">
              <p
                class="form-input input-bold"
                formControlName="date"
                contenteditable
              ></p>
              <p
                class="form-input"
                formControlName="summary"
                contenteditable
              ></p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </form>
</div>
<!-- END OF MAIN CV FORM -->
<!-- UPLOAD IMAGE -->
<div id="uploadImg" style="display: block" *ngIf="imageEditorIsOn">
  <div class="uploadContainer">
    <h4>Chỉnh sửa ảnh đại diện</h4>
    <div class="uploadMain">
      <div class="editor-col-left">
        <h5>Ảnh gốc</h5>
        <div class="editorChooseImage" [class.show]="imageChangedEvent === ''">
          <span
            style="cursor: pointer;"
            class="btn-choose-image"
            (click)="uploadImageInput.click()"
            ><i class="fa fa-image"></i>
            <br />
            Click hoặc kéo thả ảnh để tải lên</span
          >
          <input
            #uploadImageInput
            type="file"
            style="display: none"
            (change)="fileChangeEvent($event)"
          />
        </div>
        <div class="imageEditor" [class.show]="imageChangedEvent !== ''">
          <image-cropper
            [imageChangedEvent]="imageChangedEvent"
            [maintainAspectRatio]="true"
            [containWithinAspectRatio]="containWithinAspectRatio"
            [resizeToWidth]="160"
            [cropperMinWidth]="128"
            [onlyScaleDown]="true"
            [roundCropper]="false"
            [canvasRotation]="canvasRotation"
            [transform]="transform"
            [alignImage]="'center'"
            [style.display]="showCropper ? null : 'none'"
            format="png"
            (imageCropped)="imageCropped($event)"
            (imageLoaded)="imageLoaded()"
            (cropperReady)="cropperReady($event)"

          ></image-cropper>
        </div>
        <div class="tipCompress">
          Nếu ảnh của bạn có dung lượng trên 5MB, vui lòng
          <a href="https://compressor.io/" target="_blank" style="color: black"
            >bấm vào đây</a
          >
          để giảm dung lượng ảnh
        </div>
      </div>
      <div class="editor-col-right">
        <h5>Ảnh hiển thị trên CV</h5>
        <div class="imageEditorControls">
          <div class="img-edit-preview">
            <img style="width: 100%" [src]="croppedImage" />
          </div>
          <div class="edit-img-btns mt-2">
            <button
              class="btn btn-change-image"
              (click)="uploadImageInput.click()"
            >
              Đổi ảnh
            </button>
            <button
              class="btn btn-remove-image"
              (click)="onDeleteProfileImage()"
            >
              Xóa ảnh
            </button>
          </div>
          <div class="mt-2">
            <button class="btn btn-save-image" (click)="onDoneEditImage()">
              Xong
            </button>
          </div>
          <div>
            <span
              class="btn-close-image-editor"
              style="cursor: pointer;"
              (click)="imageEditorIsOn = false"
              >Đóng lại (Không lưu)</span
            >
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- END OF UPLOAD IMAGE -->
<!-- DISPLAY MODE -->
<div *ngIf="displayMode" style="width: 450px; margin: auto; margin-top: 2rem">
  <div id="sort" style="width: 80%; margin: auto">
    <div class="form-check">
      <input
        class="form-check-input selector"
        type="checkbox"
        value="objective"
        [checked]="display.objective"
        (change)="display.objective = !display.objective"
      />
      <label class="form-check-label"> Mục tiêu nghề nghiệp </label>
    </div>
    <div class="form-check">
      <input
        class="form-check-input selector"
        type="checkbox"
        value=""
        [checked]="display.skills"
        (change)="display.skills = !display.skills"
      />
      <label class="form-check-label"> Các kỹ năng </label>
    </div>
    <div class="form-check">
      <input
        class="form-check-input selector"
        type="checkbox"
        value=""
        [checked]="display.interests"
        (change)="display.interests = !display.interests"
      />
      <label class="form-check-label"> Sở thích </label>
    </div>
    <div class="form-check">
      <input
        class="form-check-input selector"
        type="checkbox"
        value=""
        [checked]="display.references"
        (change)="display.references = !display.references"
      />
      <label class="form-check-label"> Người tham chiếu </label>
    </div>
    <div class="form-check">
      <input
        class="form-check-input selector"
        type="checkbox"
        value=""
        [checked]="display.additionalInformation"
        (change)="
          display.additionalInformation = !display.additionalInformation
        "
      />
      <label class="form-check-label"> Thông tin thêm </label>
    </div>
    <div class="form-check">
      <input
        class="form-check-input selector"
        type="checkbox"
        value=""
        [checked]="display.education"
        (change)="display.education = !display.education"
      />
      <label class="form-check-label"> Học vấn </label>
    </div>
    <div class="form-check">
      <input
        class="form-check-input selector"
        type="checkbox"
        value=""
        [checked]="display.work"
        (change)="display.work = !display.work"
      />
      <label class="form-check-label"> Kinh nghiệm làm việc </label>
    </div>
    <div class="form-check">
      <input
        class="form-check-input selector"
        type="checkbox"
        value=""
        [checked]="display.activities"
        (change)="display.activities = !display.activities"
      />
      <label class="form-check-label"> Hoạt động </label>
    </div>
    <div class="form-check">
      <input
        class="form-check-input selector"
        type="checkbox"
        value=""
        [checked]="display.awards"
        (change)="display.awards = !display.awards"
      />
      <label class="form-check-label"> Giải thưởng </label>
    </div>
    <div class="form-check">
      <input
        class="form-check-input selector"
        type="checkbox"
        value=""
        [checked]="display.certifications"
        (change)="display.certifications = !display.certifications"
      />
      <label class="form-check-label"> Chứng chỉ </label>
    </div>
    <div>
      <button
        type="button"
        class="btn btn-success"
        (click)="toggleDisplayMode()"
      >
        Cập nhật
      </button>
      <!-- <div class="form-check">
        <input class="form-check-input selector" type="radio" checked/>
        <label class="form-check-label"> Chọn hết </label>
      </div>
      <div class="form-check">
        <input class="form-check-input selector" type="radio" />
        <label class="form-check-label"> Bỏ chọn hết </label>
      </div> -->
    </div>
  </div>
</div>
<!-- END OF DISPLAY MODE -->
<!-- CONTROLLER FOR FORMARRAY -->
<ng-template #controller let-i="index" let-form="form">
  <div class="controller">
    <button
      type="button"
      class="btn move-btn"
      (click)="reorder(form, -1, i)"
      [disabled]="i === 0"
    >
      <i class="fa fa-angle-up"></i>
    </button>
    <button type="button" class="btn move-btn" (click)="reorder(form, 1, i)">
      <i class="fa fa-angle-down"></i>
    </button>
    <button
      type="button"
      class="btn btn-success btn-add"
      (click)="onAddField(form)"
    >
      <i class="fa fa-plus"></i> Thêm
    </button>
    <button
      type="button"
      class="btn btn-danger btn-minus"
      (click)="onRemoveField(form, i)"
      *ngIf="form.value.length > 1"
    >
      <i class="fa fa-minus"></i> Xóa
    </button>
  </div>
</ng-template>
<!-- CONTROLLER FOR FORMGROUP -->
<ng-template #controller2 let-field="field">
  <div class="controller2">
    <button class="btn btn-sort me-2" (click)="toggleDisplayMode()">
      <div></div>
      <div></div>
      <div></div>
    </button>
    <button
      type="button"
      class="btn btn-danger btn-hide"
      (click)="hideField(field)"
    >
      <i class="fa fa-minus"></i> Ẩn mục
    </button>
  </div>
</ng-template>

